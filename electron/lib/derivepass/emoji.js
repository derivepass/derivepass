'use strict';

const util = require('util');
const crypto = require('crypto');
const EventEmitter = require('events').EventEmitter;
const BN = require('bn.js');

const SMILE = [
  "ðŸ˜€",    "ðŸ˜ƒ",      "ðŸ˜„",    "ðŸ˜†", "ðŸ˜…",    "ðŸ˜‚",    "â˜ºï¸", "ðŸ˜Š",
  "ðŸ˜‡",    "ðŸ™‚",   "ðŸ™ƒ", "ðŸ˜‰", "ðŸ˜Œ",    "ðŸ˜",    "ðŸ˜˜",      "ðŸ˜—",
  "ðŸ˜™",    "ðŸ˜š",      "ðŸ˜‹",    "ðŸ˜œ", "ðŸ˜",    "ðŸ˜›",    "ðŸ¤‘",   "ðŸ¤—",
  "ðŸ¤“", "ðŸ˜Ž",      "ðŸ˜",    "ðŸ˜’", "ðŸ˜ž",    "ðŸ˜”",    "ðŸ˜Ÿ",      "ðŸ˜¬",
  "ðŸ™", "â˜¹ï¸", "ðŸ˜£",    "ðŸ˜–", "ðŸ˜«",    "ðŸ˜©",    "ðŸ˜¤",      "ðŸ˜•",
  "ðŸ˜¡",    "ðŸ˜¶",      "ðŸ˜",    "ðŸ˜‘", "ðŸ˜¯",    "ðŸ˜¦",    "ðŸ˜§",      "ðŸ˜®",
  "ðŸ˜²",    "ðŸ˜µ",      "ðŸ˜³",    "ðŸ˜¨", "ðŸ˜°",    "ðŸ˜¢",    "ðŸ˜¥",      "ðŸ˜",
  "ðŸ˜­",    "ðŸ˜“",      "ðŸ˜ª",    "ðŸ˜´", "ðŸ™„", "ðŸ¤”", "ðŸ˜ ",      "ðŸ¤",
  "ðŸ˜·",    "ðŸ¤’",   "ðŸ¤•", "ðŸ˜ˆ", "ðŸ‘¿",    "ðŸ‘»",    "ðŸ’€",      "â˜ ï¸",
  "ðŸ‘½",    "ðŸ‘¾",      "ðŸ¤–", "ðŸŽƒ", "ðŸ˜º",    "ðŸ˜¸",    "ðŸ˜¹",      "ðŸ˜»",
  "ðŸ˜¼",    "ðŸ˜½",      "ðŸ˜¿",    "ðŸ˜¾"];
const GESTURE = [
  "ðŸ‘", "ðŸ‘Œ",      "ðŸ‘", "ðŸ™",    "ðŸ‘", "ðŸ‘Ž", "ðŸ‘Š",
  "âœŠ", "âœŒï¸", "ðŸ™Œ", "ðŸ¤˜", "ðŸ‘ˆ", "ðŸ‘‰", "ðŸ‘†",
  "ðŸ‘‡", "â˜ï¸", "âœ‹", "ðŸ––", "ðŸ‘‹", "ðŸ’ª"];
const ANIMAL = [
  "ðŸ¶",    "ðŸ±",    "ðŸ­",    "ðŸ¹", "ðŸ°",    "ðŸ»",    "ðŸ¼",   "ðŸ¨", "ðŸ¯", "ðŸ¦",
  "ðŸ¦ƒ", "ðŸ·",    "ðŸ®",    "ðŸµ", "ðŸ’",    "ðŸ”",    "ðŸ§",   "ðŸ¦", "ðŸ¤", "ðŸ£",
  "ðŸ¥",    "ðŸº",    "ðŸ—",    "ðŸ´", "ðŸ¦„", "ðŸ",    "ðŸ›",   "ðŸŒ", "ðŸš", "ðŸž",
  "ðŸœ",    "ðŸ•·", "ðŸ¢",    "ðŸ", "ðŸ¦‚", "ðŸ¦€", "ðŸ™",   "ðŸ ", "ðŸŸ", "ðŸ¡",
  "ðŸ¬",    "ðŸ³",    "ðŸ‹",    "ðŸŠ", "ðŸ†",    "ðŸ…",    "ðŸƒ",   "ðŸ‚", "ðŸ„", "ðŸª",
  "ðŸ«",    "ðŸ˜",    "ðŸŽ",    "ðŸ–", "ðŸ",    "ðŸ",    "ðŸ‘",   "ðŸ•", "ðŸ©", "ðŸˆ",
  "ðŸ“",    "ðŸ½",    "ðŸ•Š", "ðŸ‡", "ðŸ",    "ðŸ€",    "ðŸ¿"];
const FOOD = [
  "ðŸ", "ðŸŽ", "ðŸ",      "ðŸŠ", "ðŸ‹", "ðŸŒ",    "ðŸ‰", "ðŸ‡", "ðŸ“",    "ðŸˆ",    "ðŸ’",
  "ðŸ‘", "ðŸ", "ðŸ…",      "ðŸ†", "ðŸŒ½", "ðŸŒ¶", "ðŸ ", "ðŸŒ°", "ðŸ¯",    "ðŸž",    "ðŸ§€",
  "ðŸ³", "ðŸ¤", "ðŸ—",      "ðŸ–", "ðŸ•", "ðŸŒ­", "ðŸ”", "ðŸŸ", "ðŸŒ®", "ðŸŒ¯", "ðŸ",
  "ðŸœ", "ðŸ²", "ðŸ¥",      "ðŸ£", "ðŸ±", "ðŸ›",    "ðŸš", "ðŸ™", "ðŸ˜",    "ðŸ¢",    "ðŸ¡",
  "ðŸ§", "ðŸ¨", "ðŸ¦",      "ðŸº", "ðŸŽ‚", "ðŸ®",    "ðŸ­", "ðŸ¬", "ðŸ«",    "ðŸ¿", "ðŸ©",
  "ðŸª", "ðŸ°", "â˜•ï¸", "ðŸµ", "ðŸ¶", "ðŸ¼",    "ðŸ»", "ðŸ·", "ðŸ¸",    "ðŸ¹",    "ðŸ¾"];
const OBJECT = [
  "âŒšï¸", "ðŸ“±",      "ðŸ’»",       "âŒ¨ï¸", "ðŸ–¥",   "ðŸ–¨", "ðŸ–±",
  "ðŸ–²",   "ðŸ•¹",   "ðŸ—œ",    "ðŸ’¾",      "ðŸ’¿",      "ðŸ“¼",    "ðŸ“·",
  "ðŸ—‘",   "ðŸŽž",   "ðŸ“ž",       "â˜Žï¸", "ðŸ“Ÿ",      "ðŸ“ ",    "ðŸ“º",
  "ðŸ“»",      "ðŸŽ™",   "â±",       "âŒ›ï¸", "ðŸ“¡",      "ðŸ”‹",    "ðŸ”Œ",
  "ðŸ’¡",      "ðŸ”¦",      "ðŸ•¯",    "ðŸ’·",      "ðŸ›¢",   "ðŸ’µ",    "ðŸ’´",
  "ðŸŽ¥",      "ðŸ’¶",      "ðŸ’³",       "ðŸ’Ž",      "âš–ï¸", "ðŸ”§",    "ðŸ”¨",
  "ðŸ”©",      "âš™ï¸", "ðŸ”«",       "ðŸ’£",      "ðŸ”ª",      "ðŸ—¡", "ðŸš¬",
  "ðŸ”®",      "ðŸ“¿",   "ðŸ’ˆ",       "âš—ï¸", "ðŸ”­",      "ðŸ”¬",    "ðŸ•³",
  "ðŸ’Š",      "ðŸ’‰",      "ðŸŒ¡",    "ðŸš½",      "ðŸš°",      "ðŸ›",    "ðŸ›Ž",
  "ðŸ—",   "ðŸšª",      "ðŸ›‹",    "ðŸ›",   "ðŸ–¼",   "ðŸ›", "ðŸŽ",
  "ðŸŽˆ",      "ðŸŽ€",      "ðŸŽ‰",       "âœ‰ï¸", "ðŸ“¦",      "ðŸ·", "ðŸ“«",
  "ðŸ“¯",      "ðŸ“œ",      "ðŸ“†",       "ðŸ“…",      "ðŸ“‡",      "ðŸ—ƒ", "ðŸ—„",
  "ðŸ“‹",      "ðŸ“‚",      "ðŸ—ž",    "ðŸ““",      "ðŸ“–",      "ðŸ”—",    "ðŸ“Ž",
  "ðŸ“",      "ðŸ“Œ",      "ðŸ³ï¸", "ðŸŒˆ",      "âœ‚ï¸", "ðŸ–Œ", "âœï¸",
  "ðŸ”",      "ðŸ”’",      "ðŸ´"];
const ALPHABET = [ SMILE, GESTURE, ANIMAL, FOOD, OBJECT ];

function Emoji(input, label) {
  this.input = document.getElementById(input);
  this.label = document.getElementById(label);

  this.input.onkeypress = () => this.update();
  this.input.onkeyup = () => this.update();
  this.input.onchange = () => this.update();

  this.previous = 'ðŸ˜¬';
}
util.inherits(Emoji, EventEmitter);
module.exports = Emoji;

Emoji.prototype.setEmoji = function setEmoji(emoji, master) {
  if (this.previous === emoji)
    return;
  this.previous = emoji;
  this.label.textContent = emoji;
  this.emit('emoji', emoji, master);
};

Emoji.prototype.update = function update() {
  const value = this.input.value;

  if (value === '') {
    this.setEmoji('ðŸ˜¬', value);
    return;
  }

  const text = 'derivepass/' + value;
  const digest = crypto.createHash('sha512').update(text).digest();

  const fingerprint = new BN(digest.slice(0, 8), 'le');

  let out = '';
  for (let i = 0; i < ALPHABET.length; i++) {
    const idx = fingerprint.modn(ALPHABET[i].length);
    fingerprint.idivn(ALPHABET[i].length);

    out += ALPHABET[i][idx];
  }

  this.setEmoji(out, value);
};
